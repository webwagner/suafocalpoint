(function(a){a.fn.maskMoney=function(b){b=a.extend({symbol:"US$",showSymbol:false,symbolStay:false,thousands:",",decimal:".",precision:2,defaultZero:true,allowZero:false,allowNegative:false},b);return this.each(function(){var j=a(this);function m(u){u=u||window.event;var p=u.charCode||u.keyCode||u.which;if(p==undefined){return false}if(j.attr("readonly")&&(p!=13&&p!=9)){return false}if(p<48||p>57){if(p==45){j.val(e(j));return false}if(p==43){j.val(j.val().replace("-",""));return false}else{if(p==13||p==9){return true}else{if(p==37||p==39){return true}else{i(u);return true}}}}else{if(j.val().length==j.attr("maxlength")){return false}else{i(u);var s=String.fromCharCode(p);var o=j.get(0);var t=j.getInputSelection(o);var r=t.start;var q=t.end;o.value=o.value.substring(0,r)+s+o.value.substring(q,o.value.length);d(o,r+1);return false}}}function h(t){t=t||window.event;var p=t.charCode||t.keyCode||t.which;if(p==undefined){return false}if(j.attr("readonly")&&(p!=13&&p!=9)){return false}var o=j.get(0);var s=j.getInputSelection(o);var r=s.start;var q=s.end;if(p==8){i(t);if(r==q){o.value=o.value.substring(0,r-1)+o.value.substring(q,o.value.length);r=r-1}else{o.value=o.value.substring(0,r)+o.value.substring(q,o.value.length)}d(o,r);return false}else{if(p==9){return true}else{if(p==46||p==63272){i(t);if(o.selectionStart==o.selectionEnd){o.value=o.value.substring(0,r)+o.value.substring(q+1,o.value.length)}else{o.value=o.value.substring(0,r)+o.value.substring(q,o.value.length)}d(o,r);return false}else{return true}}}}function k(q){var o=l();if(j.val()==o){j.val("")}else{if(j.val()==""&&b.defaultZero){j.val(c(o))}else{j.val(c(j.val()))}}if(this.createTextRange){var p=this.createTextRange();p.collapse(false);p.select()}}function f(o){if(a.browser.msie){m(o)}if(j.val()==""||j.val()==c(l())||j.val()==b.symbol){if(!b.allowZero){j.val("")}else{if(!b.symbolStay){j.val(l())}else{j.val(c(l()))}}}else{if(!b.symbolStay){j.val(j.val().replace(b.symbol,""))}else{if(b.symbolStay&&j.val()==b.symbol){j.val(c(l()))}}}}function i(o){if(o.preventDefault){o.preventDefault()}else{o.returnValue=false}}function d(o,q){var p=j.val().length;j.val(g(o.value));var r=j.val().length;q=q-(p-r);j.setCursorPosition(q)}function g(z){z=z.replace(b.symbol,"");var o="0123456789";var w=z.length;var y="",A="",s="";if(w!=0&&z.charAt(0)=="-"){z=z.replace("-","");if(b.allowNegative){s="-"}}if(w==0){if(!b.defaultZero){return A}A="0.00"}for(var u=0;u<w;u++){if((z.charAt(u)!="0")&&(z.charAt(u)!=b.decimal)){break}}for(;u<w;u++){if(o.indexOf(z.charAt(u))!=-1){y+=z.charAt(u)}}var r=parseFloat(y);r=isNaN(r)?0:r/Math.pow(10,b.precision);A=r.toFixed(b.precision);u=b.precision==0?0:1;var q,x=(A=A.split("."))[u].substr(0,b.precision);for(q=(A=A[0]).length;(q-=3)>=1;){A=A.substr(0,q)+b.thousands+A.substr(q)}return(b.precision>0)?c(s+A+b.decimal+x+Array((b.precision+1)-x.length).join(0)):c(s+A)}function n(){var o=j.val();j.val(g(o))}function l(){var o=parseFloat("0")/Math.pow(10,b.precision);return(o.toFixed(b.precision)).replace(new RegExp("\\.","g"),b.decimal)}function c(o){if(b.showSymbol){if(o.substr(0,b.symbol.length)!=b.symbol){return b.symbol+o}}return o}function e(p){if(b.allowNegative){var o=p.val();if(p.val()!=""&&p.val().charAt(0)=="-"){return p.val().replace("-","")}else{return"-"+p.val()}}else{return p.val()}}j.bind("keypress.maskMoney",m);j.bind("keydown.maskMoney",h);j.bind("blur.maskMoney",f);j.bind("focus.maskMoney",k);j.bind("mask",n);j.one("unmaskMoney",function(){j.unbind(".maskMoney");if(a.browser.msie){this.onpaste=null}else{if(a.browser.mozilla){this.removeEventListener("input",f,false)}}})})};a.fn.unmaskMoney=function(){return this.trigger("unmaskMoney")};a.fn.mask=function(){return this.trigger("mask")};a.fn.setCursorPosition=function(b){this.each(function(d,e){if(e.setSelectionRange){e.focus();e.setSelectionRange(b,b)}else{if(e.createTextRange){var c=e.createTextRange();c.collapse(true);c.moveEnd("character",b);c.moveStart("character",b);c.select()}}});return this};a.fn.getInputSelection=function(f){var i=0,d=0,h,e,c,b,g;if(typeof f.selectionStart=="number"&&typeof f.selectionEnd=="number"){i=f.selectionStart;d=f.selectionEnd}else{e=document.selection.createRange();if(e&&e.parentElement()==f){b=f.value.length;h=f.value.replace(/\r\n/g,"\n");c=f.createTextRange();c.moveToBookmark(e.getBookmark());g=f.createTextRange();g.collapse(false);if(c.compareEndPoints("StartToEnd",g)>-1){i=d=b}else{i=-c.moveStart("character",-b);i+=h.slice(0,i).split("\n").length-1;if(c.compareEndPoints("EndToEnd",g)>-1){d=b}else{d=-c.moveEnd("character",-b);d+=h.slice(0,d).split("\n").length-1}}}}return{start:i,end:d}}})(jQuery);